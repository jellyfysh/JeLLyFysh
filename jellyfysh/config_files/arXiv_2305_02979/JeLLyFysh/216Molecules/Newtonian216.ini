# JeLLFysh - a Python application for all-atom event-chain Monte Carlo - https://github.com/jellyfysh
# Copyright (C) 2019, 2022 The JeLLyFysh organization
# (See the AUTHORS.md file for the full list of authors.)
#
# This file is part of JeLLyFysh.
#
# JeLLyFysh is free software: you can redistribute it and/or modify it under the terms of the GNU General Public
# License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later
# version.
#
# JeLLyFysh is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied
# warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along with JeLLyFysh in the LICENSE file.
# If not, see <https://www.gnu.org/licenses/>.
#
# If you use JeLLyFysh in published work, please cite the following reference (see [Hoellmer2020] in References.bib):
# Philipp Hoellmer, Liang Qin, Michael F. Faulkner, A. C. Maggs, and Werner Krauth,
# JeLLyFysh-Version1.0 -- a Python application for all-atom event-chain Monte Carlo,
# Computer Physics Communications, Volume 253, 107168 (2020), https://doi.org/10.1016/j.cpc.2020.107168.
#
[Run]
mediator = single_process_mediator
setting = hypercubic_setting

[HypercubicSetting]
system_length = 18.975
beta = 1.679
dimension = 3

[SingleProcessMediator]
state_handler = newtonian_tree_state_handler
scheduler = list_scheduler
activator = tag_activator
input_output_handler = input_output_handler

[TagActivator]
taggers =
    harmonic (factor_type_map_in_state_tagger),
    bending (factor_type_map_in_state_tagger),
    oxygen_cell_boundary (cell_boundary_tagger),
    lennard_jones_nearby (excluded_cells_tagger),
    lennard_jones_surplus (surplus_cells_tagger),
    lennard_jones_cell_veto (cell_veto_tagger),
    molecule_cell_boundary (cell_boundary_tagger),
    coulomb_nearby (excluded_cells_tagger),
    coulomb_surplus (surplus_cells_tagger),
    coulomb_cell_veto (cell_veto_tagger),
    dcd (no_in_state_tagger),
    polarization (no_in_state_tagger),
    dumping (no_in_state_tagger),
    end_of_chain (active_global_state_in_state_tagger),
    end_of_run (no_in_state_tagger),
    start_of_run (no_in_state_tagger)
internal_states = oxygen_cell (single_active_cell_occupancy), molecule_cell (single_active_cell_occupancy)

[OxygenCell]
cells = cuboid_periodic_cells
cell_level = 2
charge = oxygen_indicator

[MoleculeCell]
cells = cuboid_periodic_cells
cell_level = 1

[CuboidPeriodicCells]
cells_per_side = 12, 12, 12
neighbor_layers = 2

[FactorTypeMaps]
filename = factor_set_water.txt

[MoleculeCellBoundary]
trash = molecule_cell_boundary, coulomb_nearby, coulomb_surplus, coulomb_cell_veto, oxygen_cell_boundary
create = molecule_cell_boundary, coulomb_nearby, coulomb_surplus, coulomb_cell_veto, oxygen_cell_boundary
internal_state_label = molecule_cell
event_handler = cell_boundary_event_handler

[CoulombNearby]
trash = harmonic, bending, oxygen_cell_boundary, lennard_jones_nearby, lennard_jones_surplus, lennard_jones_cell_veto,
    molecule_cell_boundary, coulomb_nearby, coulomb_surplus, coulomb_cell_veto
create = harmonic, bending, oxygen_cell_boundary, lennard_jones_nearby, lennard_jones_surplus, lennard_jones_cell_veto,
    molecule_cell_boundary, coulomb_nearby, coulomb_surplus, coulomb_cell_veto
event_handler = coulomb_exception_event_handler_nearby (two_composite_object_event_handler_with_piecewise_constant_bounding_potential)
internal_state_label = molecule_cell
number_event_handlers = 200

[CoulombSurplus]
trash = harmonic, bending, oxygen_cell_boundary, lennard_jones_nearby, lennard_jones_surplus, lennard_jones_cell_veto,
    molecule_cell_boundary, coulomb_nearby, coulomb_surplus, coulomb_cell_veto
create = harmonic, bending, oxygen_cell_boundary, lennard_jones_nearby, lennard_jones_surplus, lennard_jones_cell_veto,
    molecule_cell_boundary, coulomb_nearby, coulomb_surplus, coulomb_cell_veto
event_handler = coulomb_exception_event_handler_surplus (two_composite_object_event_handler_with_piecewise_constant_bounding_potential)
internal_state_label = molecule_cell
number_event_handlers = 200

[CoulombCellVeto]
trash = harmonic, bending, oxygen_cell_boundary, lennard_jones_nearby, lennard_jones_surplus, lennard_jones_cell_veto,
    molecule_cell_boundary, coulomb_nearby, coulomb_surplus, coulomb_cell_veto
create = harmonic, bending, oxygen_cell_boundary, lennard_jones_nearby, lennard_jones_surplus, lennard_jones_cell_veto,
    molecule_cell_boundary, coulomb_nearby, coulomb_surplus, coulomb_cell_veto
event_handler = coulomb_cell_veto_event_handler (composite_object_cell_veto_event_handler)
internal_state_label = molecule_cell

[CoulombExceptionEventHandlerNearby]
potential = merged_image_coulomb_potential
max_displacement = 0.1
offset = 0.1
lifting = ratio_lifting
charge = electric_charge

[CoulombExceptionEventHandlerSurplus]
potential = merged_image_coulomb_potential
max_displacement = 0.1
offset = 0.1
lifting = ratio_lifting
charge = electric_charge

[MergedImageCoulombPotential]
prefactor = 332

[CoulombCellVetoEventHandler]
estimator = dipole_inner_point_estimator
lifting = ratio_lifting
charge = electric_charge
derivative_bounds_input_filename = coulomb_12_2.bounds
derivative_bounds_correction_factor = 1.15

[DipoleInnerPointEstimator]
potential = merged_image_coulomb_potential
dipole_separation = 1.3
dipole_charge = 0.82
prefactor = 1.3
points_per_side = 4

[Harmonic]
trash = harmonic, bending, oxygen_cell_boundary, lennard_jones_nearby, lennard_jones_surplus, lennard_jones_cell_veto,
    molecule_cell_boundary, coulomb_nearby, coulomb_surplus, coulomb_cell_veto
create = harmonic, bending, oxygen_cell_boundary, lennard_jones_nearby, lennard_jones_surplus, lennard_jones_cell_veto,
    molecule_cell_boundary, coulomb_nearby, coulomb_surplus, coulomb_cell_veto
event_handler = harmonic_event_handler (two_leaf_unit_event_handler)
number_event_handlers = 2
factor_type_maps = factor_type_maps

[HarmonicEventHandler]
potential = harmonic_potential (displaced_even_power_potential)
consider_next_image = false

[HarmonicPotential]
equilibrium_separation = 1.012
prefactor = 529.581
power = 2

[LennardJonesNearby]
trash = harmonic, bending, oxygen_cell_boundary, lennard_jones_nearby, lennard_jones_surplus, lennard_jones_cell_veto,
    molecule_cell_boundary, coulomb_nearby, coulomb_surplus, coulomb_cell_veto
create = harmonic, bending, oxygen_cell_boundary, lennard_jones_nearby, lennard_jones_surplus, lennard_jones_cell_veto,
    molecule_cell_boundary, coulomb_nearby, coulomb_surplus, coulomb_cell_veto
internal_state_label = oxygen_cell
event_handler = lennard_jones_event_handler_nearby (two_leaf_unit_event_handler)
number_event_handlers = 200

[LennardJonesEventHandlerNearby]
potential = lennard_jones_potential
consider_next_image = false

[LennardJonesPotential]
prefactor = 0.6217012
characteristic_length = 3.165492

[LennardJonesSurplus]
trash = harmonic, bending, oxygen_cell_boundary, lennard_jones_nearby, lennard_jones_surplus, lennard_jones_cell_veto,
    molecule_cell_boundary, coulomb_nearby, coulomb_surplus, coulomb_cell_veto
create = harmonic, bending, oxygen_cell_boundary, lennard_jones_nearby, lennard_jones_surplus, lennard_jones_cell_veto,
    molecule_cell_boundary, coulomb_nearby, coulomb_surplus, coulomb_cell_veto
internal_state_label = oxygen_cell
event_handler = lennard_jones_event_handler_surplus (two_leaf_unit_event_handler)
number_event_handlers = 200

[LennardJonesEventHandlerSurplus]
potential = lennard_jones_potential
consider_next_image = false

[LennardJonesCellVeto]
trash = harmonic, bending, oxygen_cell_boundary, lennard_jones_nearby, lennard_jones_surplus, lennard_jones_cell_veto,
    molecule_cell_boundary, coulomb_nearby, coulomb_surplus, coulomb_cell_veto
create = harmonic, bending, oxygen_cell_boundary, lennard_jones_nearby, lennard_jones_surplus, lennard_jones_cell_veto,
    molecule_cell_boundary, coulomb_nearby, coulomb_surplus, coulomb_cell_veto
event_handler = cell_veto_event_handler_for_lennard_jones (leaf_unit_cell_veto_event_handler)
internal_state_label = oxygen_cell

[CellVetoEventHandlerForLennardJones]
estimator = inner_point_estimator
derivative_bounds_input_filename = new_lj_12_2.bounds
derivative_bounds_correction_factor = 10.0

[InnerPointEstimator]
prefactor = 2.5
potential = lennard_jones_potential
points_per_side = 4
empirical_bound = 60

[OxygenCellBoundary]
trash = oxygen_cell_boundary, lennard_jones_nearby, lennard_jones_surplus, lennard_jones_cell_veto, molecule_cell_boundary
create = oxygen_cell_boundary, lennard_jones_nearby, lennard_jones_surplus, lennard_jones_cell_veto, molecule_cell_boundary
internal_state_label = oxygen_cell
event_handler = cell_boundary_event_handler

[Bending]
trash = harmonic, bending, oxygen_cell_boundary, lennard_jones_nearby, lennard_jones_surplus, lennard_jones_cell_veto,
    molecule_cell_boundary, coulomb_nearby, coulomb_surplus, coulomb_cell_veto
create = harmonic, bending, oxygen_cell_boundary, lennard_jones_nearby, lennard_jones_surplus, lennard_jones_cell_veto,
    molecule_cell_boundary, coulomb_nearby, coulomb_surplus, coulomb_cell_veto
event_handler = bending_event_handler (fixed_separations_event_handler_with_piecewise_constant_bounding_potential)
number_event_handlers = 1
factor_type_maps = factor_type_maps

[BendingEventHandler]
potential = bending_potential
lifting = ratio_lifting
max_displacement = 0.1
offset = 10
separations = 1, 0, 1, 2

[BendingPotential]
equilibrium_angle = 1.9764
prefactor = 75.9

[Dcd]
create = dcd
trash = dcd
event_handler = dcd_event_handler (fixed_interval_sampling_event_handler)

[DcdEventHandler]
sampling_interval = 21600.0
output_handler =  dcd_output_handler

[Polarization]
create = polarization
trash = polarization
event_handler = polarization_event_handler (fixed_interval_sampling_event_handler)

[PolarizationEventHandler]
sampling_interval = 2160.0
output_handler =  polarization_output_handler

[EndOfChain]
trash = harmonic, bending, oxygen_cell_boundary, lennard_jones_nearby, lennard_jones_surplus, lennard_jones_cell_veto,
    molecule_cell_boundary, coulomb_nearby, coulomb_surplus, coulomb_cell_veto, end_of_chain
create = harmonic, bending, oxygen_cell_boundary, lennard_jones_nearby, lennard_jones_surplus, lennard_jones_cell_veto,
    molecule_cell_boundary, coulomb_nearby, coulomb_surplus, coulomb_cell_veto, end_of_chain
event_handler = single_independent_active_newtonian_end_of_chain_event_handler

[SingleIndependentActiveNewtonianEndOfChainEventHandler]
chain_time = 2160000.0

[Dumping]
create = dumping
trash = dumping
event_handler = fixed_interval_dumping_event_handler

[FixedIntervalDumpingEventHandler]
dumping_interval = 300000.0
output_handler = dumping_output_handler

[EndOfRun]
create = end_of_run
trash = harmonic, bending, oxygen_cell_boundary, lennard_jones_nearby, lennard_jones_surplus, lennard_jones_cell_veto,
    molecule_cell_boundary, coulomb_nearby, coulomb_surplus, coulomb_cell_veto, end_of_chain, dcd, polarization,
    dumping, end_of_run
event_handler = final_time_end_of_run_event_handler

[FinalTimeEndOfRunEventHandler]
end_of_run_time = 648000000.0

[StartOfRun]
trash = start_of_run
create = harmonic, bending, oxygen_cell_boundary, lennard_jones_nearby, lennard_jones_surplus, lennard_jones_cell_veto,
    molecule_cell_boundary, coulomb_nearby, coulomb_surplus, coulomb_cell_veto, end_of_chain, dcd, polarization,
    dumping, end_of_run
event_handler = single_independent_active_random_newtonian_leaf_unit_start_of_run_event_handler

[InputOutputHandler]
output_handlers = polarization_output_handler, dcd_output_handler, dumping_output_handler
input_handler = pdb_input_handler

[DumpingOutputHandler]
filename = dump216.dat

[PdbInputHandler]
filename = Initial216.pdb
charge_values = electric_charge_values (charge_values),
                mass_values (charge_values),
                oxygen_indicator (charge_values)

[ElectricChargeValues]
charge_name = electric_charge
charge_values = 0.41, -0.82, 0.41

[OxygenIndicator]
charge_name = oxygen_indicator
charge_values = 0, 1, 0

[MassValues]
charge_name = mass
charge_values = 1, 1, 1

[DcdOutputHandler]
filename = RunTrajectory216.dcd
names_within_composite_object = H, O, H
bonds_within_composite_object = 0, 1, 1, 2

[PolarizationOutputHandler]
charge = electric_charge
filename = Polarization216.dat
